<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="my">

	<!-- 파일관리 폴더 트리 조회 -->
	<select id="S_FILE_MANAGE_TREE" resultType="HashMap" parameterType="HashMap" >
		/* S_FILE_MANAGE_TREE */
	    SELECT A.MY_FILE_MANAGE_ID
			 , A.SEQ              
			 , A.KEY_ID           
			 , A.TITLE            
			 , A.TYPE_CODE        
			 , A.COMM_FILE_ID     
			 , A.PARENT_KEY_ID    
			 , A.SHOW_YN          
			 , A.DESCRIPTION
	      FROM MY_FILE_MANAGE A
	     WHERE A.COMM_USER_ID = #{CID}
	     START WITH A.PARENT_KEY_ID IS null 
	   CONNECT BY PRIOR A.KEY_ID = A.PARENT_KEY_ID
		 ORDER SIBLINGS BY A.SEQ
	</select>
	<!-- 파일관리 폴더 트리 수정 -->
	<update id="U_FILE_MANAGE_TREE" parameterType="HashMap" >
		/* U_FILE_MANAGE_TREE */
		MERGE INTO MY_FILE_MANAGE A
			 USING DUAL
			    ON (A.COMM_USER_ID = #{COMM_USER_ID} 
			   AND  A.KEY_ID = #{KEY_ID})
			  WHEN MATCHED THEN
			  UPDATE SET A.TITLE = #{TITLE}
			  		   , A.SEQ = #{SEQ}
			  		   , A.PARENT_KEY_ID = #{PARENT_KEY_ID}
			  		   , A.MID = #{MID}
			  		   , A.MDT = SYSDATE
			  		   , A.MIP = #{MIP}
			 
	</update>
</mapper>